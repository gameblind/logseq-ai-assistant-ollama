# 视频生成功能使用指南 🎬

本指南详细介绍了 Logseq AI Assistant 的视频生成功能，包括文生视频 (T2V) 和图生视频 (I2V) 两种模式。

## 🚀 快速开始

### 前置条件

1. **桥接服务运行**: 确保 MCP 桥接服务正在运行
   ```bash
   cd packages/mcp-bridge-service
   npm run dev
   ```

2. **API 配置**: 在桥接服务的配置管理界面中配置通义千问 API 密钥
   - 访问: http://localhost:3000/ui
   - 配置 `DASHSCOPE_API_KEY`

3. **插件安装**: 确保 Logseq 插件已正确安装并启用

## 📝 文生视频 (Text-to-Video)

### 基本用法

```
/gpt-t2v [视频描述]
```

### 示例

```
/gpt-t2v 一只可爱的小猫在阳光明媚的花园里追逐蝴蝶

/gpt-t2v A majestic eagle soaring through mountain peaks at sunset

/gpt-t2v 城市夜景中霓虹灯闪烁，车流如织的繁华街道
```

### 最佳实践

- **描述要具体**: 包含场景、动作、光线、情感等细节
- **避免过于复杂**: 简洁明了的描述通常效果更好
- **考虑时长**: 生成的视频通常为 3-6 秒

## 🖼️ 图生视频 (Image-to-Video)

### 基本用法

```
/gpt-i2v ![图片文件名](assets/图片路径) [动画描述]
```

### 支持的图片格式

- **本地图片**: 存储在 Logseq assets 目录中的图片
- **网络图片**: 可访问的网络图片 URL
- **格式支持**: JPG, PNG, GIF, WebP

### 示例

```
# 本地图片动画化
/gpt-i2v ![sunset.jpg](assets/sunset.jpg) 让夕阳缓缓落下，云朵轻柔飘动

# 人物照片动画化
/gpt-i2v ![portrait.png](assets/portrait.png) 让人物微笑，头发轻柔飘动

# 风景照片动画化
/gpt-i2v ![landscape.jpg](assets/landscape.jpg) 添加流水声和树叶摇摆的效果
```

### 图片处理机制

1. **路径检测**: 系统自动检测图片是本地文件还是网络 URL
2. **Base64 转换**: 本地图片自动转换为 Base64 格式传输
3. **错误处理**: 图片读取失败时会显示详细错误信息

## ⚙️ 技术细节

### 任务状态轮询

视频生成采用智能轮询机制：

- **前 1 分钟**: 每 4 秒检查一次状态
- **1 分钟后**: 每 15 秒检查一次状态
- **最大等待时间**: 4 分钟

### 文件存储

- **存储位置**: Logseq 图谱的 assets 目录
- **文件命名**: `qwen_video_YYYYMMDD_HHMMSS.mp4`
- **自动插入**: 生成完成后自动插入视频链接到当前块

### 状态显示

生成过程中会显示实时状态：

1. **任务创建**: "🎬 视频生成任务已创建..."
2. **处理中**: "⏳ 视频正在生成中，请稍候..."
3. **完成**: "✅ 视频生成完成！"
4. **失败**: "❌ 视频生成失败: [错误信息]"

## 🔧 故障排除

### 常见问题

#### 1. "No such file or directory" 错误

**原因**: 图片路径不正确或文件不存在

**解决方案**:
- 确认图片文件存在于 assets 目录中
- 检查文件名拼写是否正确
- 使用相对路径格式: `![filename](assets/filename.ext)`

#### 2. 视频生成超时

**原因**: 网络问题或 API 服务繁忙

**解决方案**:
- 检查网络连接
- 稍后重试
- 简化视频描述

#### 3. API 密钥错误

**原因**: 未配置或配置错误的 API 密钥

**解决方案**:
- 访问 http://localhost:3000/ui
- 正确配置 `DASHSCOPE_API_KEY`
- 重启桥接服务

### 调试信息

如需查看详细的调试信息：

1. 打开浏览器开发者工具 (F12)
2. 查看 Console 标签页
3. 执行视频生成命令
4. 观察网络请求和错误信息

## 📊 性能优化

### 提升生成速度

1. **简化描述**: 避免过于复杂的场景描述
2. **优化图片**: 使用适中分辨率的图片 (建议 1024x1024 以下)
3. **网络环境**: 确保稳定的网络连接

### 节省 API 调用

1. **精确描述**: 避免多次尝试，一次性提供准确描述
2. **预览图片**: 在使用 I2V 前确认图片内容合适
3. **批量处理**: 规划好要生成的视频，避免重复生成

## 🎯 最佳实践

### 文生视频 (T2V) 技巧

1. **场景设定**: 明确描述环境和背景
2. **动作描述**: 具体说明想要的动作或变化
3. **情感表达**: 添加情感色彩和氛围描述
4. **时间概念**: 考虑动作的时间顺序

### 图生视频 (I2V) 技巧

1. **图片选择**: 选择构图清晰、主体明确的图片
2. **动画方向**: 明确指定希望哪些元素产生动画
3. **保持一致**: 动画描述要与图片内容相符
4. **适度动画**: 避免过于剧烈的变化

## 🔮 未来功能

计划中的功能改进：

- [ ] 视频参数自定义 (时长、分辨率)
- [ ] 批量视频生成
- [ ] 视频编辑和后处理
- [ ] 更多视频格式支持
- [ ] 视频预览功能

## 📞 技术支持

如果遇到问题或有功能建议，请：

1. 查看本文档的故障排除部分
2. 检查项目的 GitHub Issues
3. 提交新的 Issue 并提供详细信息

---

**注意**: 视频生成功能需要消耗 API 调用额度，请合理使用。生成时间通常为 1-4 分钟，请耐心等待。