# å›¾ç‰‡ç¼–è¾‘APIæµ‹è¯•å·¥å…·

ä¸ºäº†å¸®åŠ©è°ƒè¯•å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½ï¼Œæˆ‘åˆ›å»ºäº†ä¸¤ä¸ªç‹¬ç«‹çš„æµ‹è¯•å·¥å…·ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥éªŒè¯APIé…ç½®å’Œè°ƒç”¨æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

## ğŸŒ Webç‰ˆæµ‹è¯•å·¥å…· (test-image-edit.html)

### ä½¿ç”¨æ–¹æ³•
1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `test-image-edit.html` æ–‡ä»¶
2. å¡«å†™ä»¥ä¸‹é…ç½®ä¿¡æ¯ï¼š
   - **APIåœ°å€**: æ‚¨çš„å›¾ç‰‡ç¼–è¾‘APIç«¯ç‚¹ (ä¾‹å¦‚: `https://api.example.com/v1/images/edits`)
   - **API Key**: æ‚¨çš„APIå¯†é’¥
   - **æ¨¡å‹**: é€‰æ‹© `gpt-image-1` æˆ– `qwen-image-edit`
   - **é€‰æ‹©å›¾ç‰‡**: ä¸Šä¼ è¦ç¼–è¾‘çš„å›¾ç‰‡æ–‡ä»¶
   - **é€‰æ‹©é®ç½©**: ä¸Šä¼ é®ç½©å›¾ç‰‡æ–‡ä»¶ï¼ˆå¯é€‰ï¼ŒPNGæ ¼å¼ï¼Œé€æ˜åŒºåŸŸè¡¨ç¤ºè¦ç¼–è¾‘çš„éƒ¨åˆ†ï¼‰
   - **ç¼–è¾‘æç¤ºè¯**: æè¿°æ‚¨æƒ³è¦çš„ç¼–è¾‘æ•ˆæœ
3. ç‚¹å‡» "ğŸš€ æµ‹è¯•å›¾ç‰‡ç¼–è¾‘" æŒ‰é’®
4. æŸ¥çœ‹æµ‹è¯•ç»“æœå’Œç¼–è¾‘åçš„å›¾ç‰‡

### ç‰¹ç‚¹
- âœ… å¯è§†åŒ–ç•Œé¢ï¼Œæ˜“äºä½¿ç”¨
- âœ… å®æ—¶æ˜¾ç¤ºè¯·æ±‚å’Œå“åº”è¿‡ç¨‹
- âœ… æ”¯æŒå›¾ç‰‡é¢„è§ˆå’Œä¸‹è½½
- âœ… è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯æ˜¾ç¤º

## ğŸ–¥ï¸ Node.jsç‰ˆæµ‹è¯•å·¥å…· (test-image-edit.js)

### å®‰è£…ä¾èµ–
```bash
npm install form-data node-fetch
```

### é…ç½®
ç¼–è¾‘ `test-image-edit.js` æ–‡ä»¶é¡¶éƒ¨çš„ `CONFIG` å¯¹è±¡ï¼š

```javascript
const CONFIG = {
    apiUrl: 'https://your-api-endpoint.com/v1/images/edits', // æ‚¨çš„APIåœ°å€
    apiKey: 'your-api-key-here', // æ‚¨çš„API Key
    model: 'gpt-image-1', // æˆ– 'qwen-image-edit'
    imagePath: './test-image.jpg', // æµ‹è¯•å›¾ç‰‡çš„è·¯å¾„
    prompt: 'å°†èƒŒæ™¯æ”¹ä¸ºè“å¤©ç™½äº‘' // ç¼–è¾‘æç¤ºè¯
};
```

### ä½¿ç”¨æ–¹æ³•
1. ç¼–è¾‘ `test-image-edit.js` æ–‡ä»¶ä¸­çš„ CONFIG å¯¹è±¡ï¼š
   ```javascript
   const CONFIG = {
       apiUrl: 'https://ai.comfly.chat/v1/images/edits',
       apiKey: 'your-api-key-here',
       model: 'gpt-image-1',
       imagePath: './test-image.jpg', // å›¾ç‰‡æ–‡ä»¶è·¯å¾„
       maskPath: './mask.png', // é®ç½©æ–‡ä»¶è·¯å¾„ (å¯é€‰)
       prompt: 'ç»™è¿™å¼ å›¾ç‰‡æ·»åŠ ä¸€äº›å½©è™¹è‰²å½©',
       quality: 'auto',
       responseFormat: 'url',
       size: 'auto',
       n: 1
   };
   ```

2. è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
   ```bash
   node test-image-edit.js
   ```

### ç‰¹ç‚¹
- âœ… å‘½ä»¤è¡Œç•Œé¢ï¼Œé€‚åˆè‡ªåŠ¨åŒ–æµ‹è¯•
- âœ… è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- âœ… è‡ªåŠ¨ä¿å­˜ç¼–è¾‘åçš„å›¾ç‰‡
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œä¾èµ–æ£€æŸ¥

## ğŸ”§ æµ‹è¯•æ­¥éª¤å»ºè®®

### æ ¹æ®æ‚¨æä¾›çš„APIæ–‡æ¡£ï¼Œç°åœ¨å·²é¢„å¡«æ­£ç¡®çš„APIåœ°å€ï¼š
- **APIåœ°å€**: `https://ai.comfly.chat/v1/images/edits`
- **æ”¯æŒæ¨¡å‹**: `gpt-image-1`ã€`dall-e-2`
- **æ”¯æŒæ ¼å¼**: PNGã€WEBPã€JPGï¼ˆæ¯ä¸ªæ–‡ä»¶ <25MBï¼‰
- **æ–°å¢å‚æ•°æ”¯æŒ**:
  - **mask**: é®ç½©å›¾ç‰‡æ–‡ä»¶ï¼ˆå¯é€‰ï¼ŒPNGæ ¼å¼ï¼Œé€æ˜åŒºåŸŸè¡¨ç¤ºè¦ç¼–è¾‘çš„éƒ¨åˆ†ï¼‰
  - **quality**: è´¨é‡è®¾ç½®ï¼ˆä»…gpt-image-1ï¼‰- auto/high/medium/low
  - **response_format**: å“åº”æ ¼å¼ - url/b64_json
  - **size**: å›¾ç‰‡å°ºå¯¸ - auto/1024x1024/1536x1024/1024x1536ç­‰
  - **n**: ç”Ÿæˆæ•°é‡ (1-10)

### å…³äºé®ç½©(Mask)å‚æ•°çš„é‡è¦è¯´æ˜

- **æ ¼å¼è¦æ±‚**: å¿…é¡»æ˜¯PNGæ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶
- **å°ºå¯¸è¦æ±‚**: é®ç½©å›¾ç‰‡çš„å°ºå¯¸å¿…é¡»ä¸åŸå›¾å®Œå…¨ç›¸åŒ
- **é€æ˜åº¦è®¾ç½®**: å®Œå…¨é€æ˜çš„åƒç´ ï¼ˆalphaå€¼ä¸º0ï¼‰è¡¨ç¤ºè¦ç¼–è¾‘çš„åŒºåŸŸ
- **ä½¿ç”¨åœºæ™¯**: ç²¾ç¡®æ§åˆ¶å›¾ç‰‡ç¼–è¾‘çš„åŒºåŸŸï¼Œä¾‹å¦‚åªä¿®æ”¹èƒŒæ™¯æˆ–ç‰¹å®šç‰©ä½“
- **å¯é€‰å‚æ•°**: å¦‚æœä¸æä¾›é®ç½©ï¼ŒAPIä¼šæ ¹æ®æç¤ºè¯è‡ªåŠ¨åˆ¤æ–­ç¼–è¾‘åŒºåŸŸ

### æµ‹è¯•æ­¥éª¤ï¼š

1. **é¦–å…ˆä½¿ç”¨Webç‰ˆæµ‹è¯•å·¥å…·**
   - APIåœ°å€å·²é¢„å¡«ä¸º `https://ai.comfly.chat/v1/images/edits`
   - API Keyå·²é¢„å¡«ä¸ºæµ‹è¯•token
   - é€‰æ‹©æ¨¡å‹ï¼ˆæ¨è `gpt-image-1`ï¼‰
   - é…ç½®å‚æ•°ï¼ˆå¯é€‰ï¼‰ï¼š
     - è´¨é‡è®¾ç½®ï¼ˆä»…gpt-image-1æœ‰æ•ˆï¼‰
     - å“åº”æ ¼å¼ï¼ˆurlæˆ–b64_jsonï¼‰
     - å›¾ç‰‡å°ºå¯¸ï¼ˆautoæˆ–å…·ä½“å°ºå¯¸ï¼‰
     - ç”Ÿæˆæ•°é‡ï¼ˆ1-10å¼ ï¼‰
   - ä¸Šä¼ æµ‹è¯•å›¾ç‰‡
   - è¾“å…¥ç¼–è¾‘æç¤ºè¯ï¼ˆå¦‚ï¼š"å¸¦ä¸Šçœ¼é•œ"ï¼‰
   - ç‚¹å‡»æµ‹è¯•æŒ‰é’®

2. **ç„¶åä½¿ç”¨Node.jsç‰ˆæµ‹è¯•å·¥å…·**
   - APIåœ°å€å·²é¢„å¡«ä¸º `https://ai.comfly.chat/v1/images/edits`
   - API Keyå·²é¢„å¡«ä¸ºæµ‹è¯•token
   - é…ç½®å‚æ•°ï¼šå›¾ç‰‡è·¯å¾„ã€æç¤ºè¯ã€è´¨é‡ã€å“åº”æ ¼å¼ã€å°ºå¯¸ã€æ•°é‡ç­‰
   - è¿è¡Œï¼š`node test-image-edit.js`

3. **å¸¸è§é—®é¢˜æ’æŸ¥**
   - éªŒè¯API Keyæ˜¯å¦æœ‰æ•ˆï¼ˆä»æ‚¨çš„APIæœåŠ¡æä¾›å•†è·å–ï¼‰
   - ç¡®è®¤å›¾ç‰‡æ ¼å¼æ”¯æŒï¼ˆPNGã€JPGã€WEBPï¼Œ<25MBï¼‰
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤è´¦æˆ·ä½™é¢å……è¶³

## ğŸ“ æµ‹è¯•ç»“æœåˆ†æ

### æˆåŠŸçš„å“åº”åº”è¯¥åŒ…å«ï¼š
```json
{
  "data": [
    {
      "b64_json": "iVBORw0KGgoAAAANSUhEUgAA..."
    }
  ]
}
```

### å¸¸è§é”™è¯¯ç±»å‹ï¼š
- **401 Unauthorized**: API Keyæ— æ•ˆæˆ–è¿‡æœŸ
- **403 Forbidden**: æƒé™ä¸è¶³æˆ–è´¦æˆ·ä½™é¢ä¸è¶³
- **400 Bad Request**: è¯·æ±‚å‚æ•°é”™è¯¯
- **500 Internal Server Error**: APIæœåŠ¡å™¨å†…éƒ¨é”™è¯¯

## ğŸš€ ä½¿ç”¨è¿™äº›å·¥å…·çš„ä¼˜åŠ¿

1. **ç‹¬ç«‹æµ‹è¯•**: ä¸Logseqæ’ä»¶ç¯å¢ƒéš”ç¦»ï¼Œæ’é™¤æ’ä»¶ç›¸å…³é—®é¢˜
2. **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„è¯·æ±‚/å“åº”ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•
3. **å¿«é€ŸéªŒè¯**: æ— éœ€é‡æ–°æ„å»ºæ’ä»¶å³å¯æµ‹è¯•APIé…ç½®
4. **å¤šç§æ ¼å¼**: Webå’Œå‘½ä»¤è¡Œä¸¤ç§æ–¹å¼ï¼Œé€‚åº”ä¸åŒä½¿ç”¨åœºæ™¯

è¯·ä½¿ç”¨è¿™äº›å·¥å…·æµ‹è¯•æ‚¨çš„APIé…ç½®ï¼Œå¹¶å°†æµ‹è¯•ç»“æœåé¦ˆç»™æˆ‘ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ›´å‡†ç¡®åœ°å®šä½å’Œè§£å†³é—®é¢˜ï¼